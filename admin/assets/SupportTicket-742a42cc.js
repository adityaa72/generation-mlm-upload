import{u as w,s as P,c as z,a as G,d as M,o as $,bu as B,e,h as U,j as i,S as V,R as E,p as y,T as C,bv as J,L as D,bw as K,t as b,A as S,bn as N,bd as O,w as W,z as _,P as X,I as Y,C as R,bc as Z,ar as ee,bx as te,by as se,ao as ae,bz as re,an as oe,as as ie,aW as F,bA as ne}from"./index-7ce534fb.js";import{r as I}from"./warn-once-223a138d.js";import{H as ce}from"./HeaderBreadcrumbs-7dcdcbac.js";import{f as L}from"./formatTime-af0276ab.js";import{A as le,a as de}from"./AlertTitle-829aeda4.js";import{C as j}from"./CardHeader-51eb309e.js";import{C as me}from"./CardContent-d5c47145.js";import"./Close-40502a6a.js";const ue=({ticketId:a})=>{const r=w(),t=P(),s=z().shape({message:G().required("Message is required")}),c={ticketId:a,message:"",files:[]},n=M({resolver:$(s),defaultValues:c}),{watch:l,getValues:m,setValue:o,handleSubmit:u,formState:{isSubmitting:d}}=n,k=async h=>{try{await K(h),t.removeQueries(b.FetchSupportTicketsList),t.removeQueries(b.GetTicketData,a),r(S.support.root)}catch(f){console.log("ðŸš€ ~ file: TicketForm.jsx:54 ~ onSubmit ~ error",f)}},T=l(),{isSuccess:v,uploadFile:p,progress:A}=B(),H=I.useCallback(async h=>{for(const f of h){const g=m("files");o("files",[...g,{name:Math.random(),progress:A,upload:!1}]);const x=new FormData;x.append("file",f);const{fileUrl:q}=await p(x);o("files",[...g,q])}},[o,A]),Q=h=>{var g;const f=(g=T.files)==null?void 0:g.filter(x=>x!==h);o("files",f)};return e(U,{methods:n,onSubmit:u(k),children:i(V,{justifyContent:"flex-end",spacing:3,children:[e(E,{multiline:!0,minRows:4,name:"message",type:"text",label:"Message"}),i(y,{children:[i(C,{component:"div",variant:"body2",sx:{mb:2},children:["Add Files",e(C,{component:"span",color:"text.secondary",variant:"body2",children:"(Maximum 5 Files)"})]}),e(J,{name:"files",showPreview:!0,accept:"image/*",maxFiles:5,maxSize:3145728,onDrop:H,onRemove:Q})]}),e(y,{sx:{display:"flex",justifyContent:"flex-end",gap:2},children:e(D,{size:"large",type:"submit",variant:"contained",loading:d,children:"Submit"})})]})})},Ce=()=>{const a=N(),r=O(),t=w(),{id:s}=a,c=P(),[n,l]=I.useState(!1),m=async()=>{try{await r({description:"Are you sure want to close this ticket?"}),l(!0),await re(s),c.removeQueries(b.FetchSupportTicketsList),c.removeQueries(b.GetTicketData,s),t(S.support.root)}catch{l(!1)}},{data:{data:o={}}={},isLoading:u}=W([b.GetTicketData,s],()=>ne(s)),{status:d,closedAt:k,closedBy:T,ticketMessages:v}=o;return u?e(_,{}):i(X,{title:`Ticket #${s}`,children:[e(ce,{heading:"Support",links:[{name:"Support",href:`${S.support.root}`},{name:`Ticket #${s}`}],action:d==="closed"?void 0:e(D,{color:"error",to:"create-ticket",variant:"contained",size:"large",startIcon:e(Y,{icon:"jam:close-circle"}),onClick:m,loading:n,loadingPosition:"start",children:n?"Closing Ticket...":"Close Ticket"})}),d==="closed"?i(le,{severity:"error",sx:{mb:4},children:[e(de,{children:"Ticket Closed"}),"This ticket was closed by ",T," at ",e("strong",{children:L(k)})]}):i(R,{sx:{mb:4},children:[i(y,{sx:{bgcolor:"background.neutral"},children:[e(j,{title:"Add reply"}),e(Z,{})]}),e(y,{p:3,children:e(ue,{isReply:!0,ticketId:s})})]}),v==null?void 0:v.map(p=>e(he,{...p},p.messageId))]})};function pe({avatar:a,displayName:r}){return e(oe,{alt:"name",src:ie(a),color:a?"default":F(r).color,sx:{borderRadius:99,width:48,height:48},children:F(r).name})}const he=({createdAt:a,repliedBy:r,files:t,message:s,displayName:c,avatar:n})=>{const{user:{userId:l}={}}=ee(),m=l===r;try{t=JSON.parse(t)}catch{}return Array.isArray(t)||(t=[]),i(R,{sx:{mb:4,...m||{ml:4}},children:[e(j,{avatar:e(pe,{avatar:n,displayName:c}),title:r,subheader:L(a),sx:{pb:0}}),i(me,{children:[e(C,{variant:"body2",color:"text.secondary",children:s}),e(te,{sx:{display:"flex"},children:t==null?void 0:t.map((o,u)=>e(se,{component:"div",sx:{p:0,m:.5,width:80,height:80,borderRadius:1.25,overflow:"hidden",position:"relative",display:"inline-flex",border:d=>`solid 1px ${d.palette.divider}`},children:e(y,{children:e(ae,{src:o})})},u))})]})]})};export{Ce as default};
