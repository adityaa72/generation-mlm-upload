import{at as A,bU as C,as as I,aS as P,u as w,j as e,B as m,L,a as o,P as S,K as F,i as B,g as k,bd as j,av as D,T as H,bF as Q,bG as q,I as G,cy as R,q as g,A as $,b7 as z,b8 as K,bh as T,cz as E}from"./index-a3673b34.js";import{r as J}from"./warn-once-32b7c465.js";import{H as N}from"./HeaderBreadcrumbs-006bc24f.js";import{f}from"./formatTime-cc18d177.js";import{T as O}from"./SupportTicketForm-428748ea.js";import{A as U}from"./Alert-b65ce8b8.js";import{A as _}from"./AlertTitle-bce60c97.js";import{C as x}from"./CardHeader-a92719a0.js";import{C as M}from"./CardContent-73270362.js";import"./Close-30065dfa.js";const V=({createdAt:a,repliedBy:i,files:r,message:t,displayName:c,avatar:n})=>{const{user:{userId:d,userName:y}}=D(),b=d!==i;try{r=JSON.parse(r)}catch{}return Array.isArray(r)||(r=[]),o(k,{sx:{mb:4,...b&&{ml:4}},children:[e(x,{avatar:e(W,{avatar:n,displayName:c}),title:c,subheader:f(a),sx:{pb:0}}),o(M,{children:[e(H,{variant:"body2",color:"text.secondary",children:t}),e(Q,{sx:{display:"flex"},children:r==null?void 0:r.map((s,l)=>e(q,{component:"div",sx:{p:0,m:.5,width:80,height:80,borderRadius:1.25,overflow:"hidden",position:"relative",display:"inline-flex",border:u=>`solid 1px ${u.palette.divider}`},children:e(m,{children:e(G,{src:s})})},l))})]})]})},ce=()=>{const a=A(),i=C(),r=I(),{id:t}=a,c=P(),[n,d]=J.useState(!1),y=async()=>{try{await i({description:"Are you sure want to close this ticket?"}),d(!0),await R(t),c.invalidateQueries([g.FetchSupportTicketsList]),c.invalidateQueries([g.FetchTicket,t]),r($.support.root)}catch{d(!1)}},{isLoading:b,data:s}=w([g.FetchTicket,t],()=>E(t),{staleTime:1/0});if(!(s!=null&&s.data))return e(m,{sx:{width:"100%"},children:e(L,{})});const{status:l,closedAt:u,closedBy:v,ticketMessages:h}=s==null?void 0:s.data;return o(S,{title:`Ticket #${t}`,children:[e(N,{heading:"Support",links:[{name:"Dashboard"},{name:"Support",href:"/support"},{name:`Ticket #${t}`}],action:l==="closed"?void 0:e(F,{color:"error",to:"create-ticket",variant:"contained",size:"large",startIcon:e(B,{icon:"jam:close-circle"}),onClick:y,loading:n,loadingPosition:"start",children:n?"Closing Ticket...":"Close Ticket"})}),l==="closed"?o(U,{severity:"error",sx:{mb:4},children:[e(_,{children:"Ticket Closed"}),"This ticket was closed by ",v," at ",e("strong",{children:f(u)})]}):o(k,{sx:{mb:4},children:[o(m,{sx:{bgcolor:"background.neutral"},children:[e(x,{title:"Add reply"}),e(j,{})]}),e(m,{p:3,children:e(O,{isReply:!0,ticketId:t})})]}),h==null?void 0:h.map(p=>e(V,{...p},p.messageId))]})};function W({avatar:a,displayName:i}){return e(z,{alt:"name",src:K(a),color:a?"default":T(i).color,sx:{borderRadius:99,width:48,height:48},children:T(i).name})}export{ce as default};
