import{a as r,B as d,j as e,bg as B,bh as P,i as R,T as n,k as h,a7 as ae,q as S,a1 as u,g as G,S as f,l as ne,L as U,u as F,bN as se,aS as ie,y as oe,z as le,D as ce,N as de,bO as ue,aT as Q,H as me,aU as L,Z as he,bP as q,aV as O,J as fe,aZ as ye,K as pe,bQ as be,bR as ge,d as _,F as xe,s as Te,P as ve,A as Se,c as D,bS as Ce}from"./index-a3673b34.js";import{r as C}from"./warn-once-32b7c465.js";import{H as Pe}from"./HeaderBreadcrumbs-006bc24f.js";import{u as T,D as Ae,a as we}from"./DataTable-fbcfd2cf.js";import{f as De}from"./formatTime-cc18d177.js";import{c as Re}from"./index-03944998.js";import{C as ke}from"./CardHeader-a92719a0.js";import{C as Ie}from"./CurrencyTextField-8e74f591.js";import{A as qe}from"./Alert-b65ce8b8.js";import"./index-1771e82c.js";import"./EmptyContent-25dcb732.js";import"./Close-30065dfa.js";import"./Skeleton-179a775c.js";import"./KeyboardArrowRight-32007a10.js";const We=()=>{const a=[{field:"createdAt",sort:"desc"}],s=[{field:"agentId",headerName:T("User"),minWidth:200,flex:1,renderCell({row:{agentId:t,avatar:i,displayName:c,status:m}}){return r(d,{display:"flex",alignItems:"center",children:[r(d,{sx:{position:"relative"},children:[e(B,{alt:"name",src:i,sx:{borderRadius:999,width:48,height:48},color:i?"default":P(c).color,children:P(c).name}),e(d,{sx:{position:"absolute",right:0,bottom:0,width:18,height:18,bgcolor:m!=="transferred"?"success.main":"error.main",borderRadius:999,display:"flex",justifyContent:"center",alignItems:"center"},children:e(R,{icon:m==="transferred"?"material-symbols:arrow-outward-rounded":"ph:arrow-down-left-bold"})})]}),r(d,{sx:{ml:2},children:[e(n,{variant:"body2",children:c}),e(n,{variant:"subtitle2",color:"text.secondary",children:t})]})]})}},{field:"transactionId",headerName:T("txn Id"),minWidth:200,flex:1},{field:"amount",headerName:T("amount"),minWidth:100,flex:1,renderCell(t){return h(t.value)}},{field:"charge",headerName:T("charge"),minWidth:100,flex:1,renderCell(t){return h(t.value)}},{field:"netAmount",headerName:T("net Amount"),minWidth:100,flex:1,renderCell(t){return h(t.value)}},{field:"status",headerName:T("status"),minWidth:150,flex:1,renderCell({value:t}){return e(ae,{color:t==="received"?"success":"error",children:Re(t)})}},{field:"createdAt",headerName:T("date"),minWidth:180,flex:1,filterable:!1,renderCell:({value:t})=>De(t)}],l=S.FetchTransferPaymentHistory;return e(Ae,{title:"Transfer Payment History",queryKey:l,sortModel:a,columns:s})},j=(a,s)=>a/s*100,z=({receivedAmount:a,transferredAmount:s})=>{const l=a+s;return r(G,{children:[e(ke,{title:"Transfer Payment Overview"}),r(f,{spacing:4,sx:{p:3},children:[e(W,{progress:{label:"Total Received",amount:a,value:j(a,l)}}),e(W,{progress:{label:"Total Transferred",amount:s,value:j(s,l)}})]})]})};z.propTypes={receivedAmount:u.number.isRequired,transferredAmount:u.number.isRequired};function W({progress:a}){return r(f,{spacing:1,children:[r(f,{direction:"row",alignItems:"center",children:[e(n,{variant:"subtitle2",sx:{flexGrow:1},children:a.label}),e(n,{variant:"subtitle2",children:h(a.amount)}),r(n,{variant:"body2",sx:{color:"text.secondary"},children:["Â (",ne(a.value),")"]})]}),e(U,{variant:"determinate",value:a.value,color:a.label==="Total Received"?"success":"error"})]})}W.propTypes={progress:u.shape({amount:u.number,label:u.string,value:u.number})};const E=({open:a,onClose:s,data:l,onBack:t})=>{const{userName:i,firstName:c,lastName:m,userId:g,avatar:v}=l,{data:{data:{charge:o,chargeType:y}={}}={},isLoading:p}=F([S.GetTransferPaymentCharge],se),b=ie(),x=oe().shape({amount:le().required("Amount is required").min(1,"Minimum amount is 1")}),[V,$]=C.useState(0),[M,Z]=C.useState(0),H=ce({defaultValues:{amount:"",receiverId:g},resolver:de(x)}),{handleSubmit:N,reset:J,watch:Y,formState:{isSubmitting:X}}=H,k=Y("amount"),ee=y==="percent"?`${o}%`:h(o),re=async A=>{try{await be(A),s(),J(),b.refetchQueries([S.GetUserWallet]),b.refetchQueries([S.FetchTransferPaymentHistory])}catch(w){console.log("ðŸš€ ~ file: TransferPaymentDialog.jsx:42 ~ onSubmit ~ error",w)}};return C.useEffect(()=>{let A=Number(k);const w=y==="percent"?k*o/100:o,te=A+w;ue(A)&&($(w),Z(te))},[k]),r(Q,{open:a,onClose:s,children:[p&&e(U,{}),r(me,{methods:H,onSubmit:N(re),children:[r(L,{children:[e(he,{onClick:t,children:e(R,{icon:q.leftArrow})}),"Transfer Payment"]}),e(O,{children:r(f,{sx:{py:3},spacing:3,children:[!!o&&r(qe,{severity:"warning",children:["Transfer Payment charge :- ",ee]}),e(d,{children:e(f,{onClick:()=>N(i,g,c,m,v),direction:"row",justifyContent:"space-between",children:r(f,{direction:"row",spacing:2,children:[e(B,{color:v?"default":P(c).color,src:v,children:P(c).name}),r(d,{children:[r(n,{variant:"subtitle2",children:[c," ",m]}),r(n,{variant:"body2",color:"text.secondary",children:[g," - ",i]})]})]})},g)}),e(fe,{maskCurrency:!0,name:"amount",label:"Amount"}),e(Ie,{disabled:!0,value:V,label:"Charge"}),r(n,{children:["Payable Amount: ",h(M)]})]})}),e(ye,{sx:{textAlign:"right"},children:e(pe,{type:"submit",loading:X,children:"Submit"})})]})]})};E.propTypes={open:u.bool.isRequired,onClose:u.func.isRequired};const Be=({open:a,onClose:s,onSubmit:l})=>{const[t,i]=C.useState(""),c=o=>{o&&o.trim()?i(o):i("")},{data:{data:m=[]}={},isFetching:g}=F([S.TransferPaymentSearchUser,t],()=>ge(t),{retry:0,keepPreviousData:!0}),v=(o,y,p,b,x)=>{l({userName:o,userId:y,firstName:p,lastName:b,avatar:x})};return r(Q,{maxWidth:"xs",scroll:"paper",open:a,onClose:s,children:[e(L,{children:"Search User"}),r(O,{children:[e(d,{sx:{mb:4},children:e(we,{fullWidth:!0,placeholder:"Search...  Userid/Username",InputProps:{startAdornment:e(R,{color:"text.secondary",sx:{mr:2,fontSize:24},icon:q.search})},onChange:c})}),r(f,{spacing:3,children:[g&&e(U,{}),!t&&e(d,{children:e(n,{color:"text.secondary",variant:"subtitle1",children:"Recent Transfer"})}),m.length?m.map(({userName:o,userId:y,firstName:p,lastName:b,avatar:x})=>r(f,{direction:"row",justifyContent:"space-between",children:[r(f,{direction:"row",spacing:2,children:[e(B,{color:x?"default":P(p).color,src:x,children:P(p).name}),r(d,{children:[r(n,{variant:"subtitle2",children:[p," ",b]}),r(n,{variant:"body2",color:"text.secondary",children:[y," - ",o]})]})]}),e(_,{onClick:()=>v(o,y,p,b,x),startIcon:e(R,{icon:q.add}),children:"Assign"})]},y)):e(xe,{children:t?e(d,{children:"No users found"}):e(d,{children:"No recent payment transfer was made"})})]})]})]})},I=Te("div")({display:"flex",justifyContent:"space-between"}),K=({receivedAmount:a,transferredAmount:s,wallet:l})=>{const[t,i]=C.useState(0),[c,m]=C.useState(null),g=()=>i(1);return r(G,{sx:{p:3},children:[t===1&&e(Be,{open:t===1,onClose:()=>i(0),onSubmit:b=>{i(2),m(b)}}),t===2&&e(E,{open:t===2,data:c,onClose:()=>i(0),onBack:()=>i(1)}),e(n,{variant:"subtitle2",gutterBottom:!0,children:"Quick Transfer"}),r(f,{spacing:2,children:[e(n,{variant:"h3",children:h(l)}),r(I,{children:[e(n,{variant:"body2",sx:{color:"text.secondary"},children:"Your Current Balance"}),e(n,{variant:"body2",children:h(l)})]}),r(I,{children:[e(n,{variant:"body2",sx:{color:"text.secondary"},children:"Sent Amount"}),e(n,{variant:"body2",children:h(s)})]}),r(I,{children:[e(n,{variant:"body2",sx:{color:"text.secondary"},children:"Received Amount"}),e(n,{variant:"body2",children:h(a)})]}),e(_,{onClick:g,size:"large",fullWidth:!0,variant:"contained",color:"success",children:"Transfer Now"})]})]})};K.propTypes={receivedAmount:u.number.isRequired,transferredAmount:u.number.isRequired,wallet:u.number.isRequired};const Ue=()=>{const{data:{data:a={receivedAmount:0,transferredAmount:0,wallet:0}}={},isLoading:s}=F([S.GetUserWallet],Ce,{staleTime:0}),{receivedAmount:l,transferredAmount:t,wallet:i}=a;return r(ve,{title:"Transfer Payment",children:[e(Pe,{heading:"Transfer Payment",links:[{name:"Dashboard",href:Se.dashboard},{name:"Transfer Payment"}]}),r(D,{container:!0,spacing:2,children:[e(D,{item:!0,xs:12,md:6,lg:8,children:e(z,{receivedAmount:l,transferredAmount:t,loading:s})}),e(D,{item:!0,xs:12,md:6,lg:4,children:e(K,{receivedAmount:l,transferredAmount:t,loading:s,wallet:i})}),e(D,{item:!0,xs:12,children:e(We,{})})]})]})},Ze=Ue;export{Ze as default};
